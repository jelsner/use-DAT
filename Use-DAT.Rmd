---
title: "Use-DAT"
output: html_document
editor_options: 
  chunk_output_type: console
---

Data from https://www.spc.noaa.gov/wcm/

```{r}
df <- read.csv("2014-2015-onetor-dat.csv")

ii <- which(is.na(df$path_data) & is.na(df$point_data))
df$path_data[ii] <- 1
```

```{r}
library(dplyr)

df1 <- df %>%
  filter(path_data == 1) %>%
  select(om:mt)

df2 <- df %>%
  filter(point_data == 1) %>%
  select(OBJECTID:edit_time.1)

df3 <- df %>%
  group_by(unique_torID) %>%
  summarize(nTargets = n() - 1)

df2$om <- rep(df1$om, times = df3$nTargets)

df2 <- df2 %>%
  filter(!is.na(lat))
```

Create simple feature.
```{r}
library(sf)
projcrs <- 4326
sfdf <- st_as_sf(x = df2,                         
                 coords = c("lon", "lat"),
                  crs = projcrs)
```

```{r}
ids <- unique(sfdf$om)
sfdf2 <- sfdf %>%
  filter(om == ids[5]) %>%
  mutate(EF = as.integer(efscale.1))

table(sfdf2$EF)
```

```{r}
library(tmap)
library(USAboundaries)

ctys <- us_counties() 

tm_shape(sfdf2) +
  tm_bubbles(size = "EF", col = "EF") +
tm_shape(ctys) +
  tm_borders()
```

Perhaps do this for each EF rating?
```{r}
path <- st_convex_hull(st_combine(sfdf2))

path2 <- st_buffer(st_triangulate(st_combine(sfdf2)), dist = .001)



tm_shape(path) +
  tm_polygons() +
tm_shape(sfdf2) +
  tm_bubbles(size = "EF", col = "EF") +
tm_shape(ctys) +
  tm_borders()
```